<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE MDM SYSTEM 'MDM.DTD'>

<!--
        <h2>Introduction</h2>
        Message definitions for the VICS scenario
-->
<MDM>
    <SeriesName>VICS</SeriesName>
    <Namespace>uxas/project/vics</Namespace>
    <Version>26</Version>

	<EnumList>
		
		<!-- Identifier for the type of payload data being
			included in the message. -->
        <Enum Name="PayloadType">
			<Entry Name="NoPayload" Value="0"/>
			<Entry Name="Unknown" Value="1"/>
			<Entry Name="Text" Value="2"/>
            <Entry Name="Image" Value="3"/>
            <Entry Name="Video" Value="4"/>
			<Entry Name="Audio" Value="5"/>
        </Enum>

		<!-- Requestor type -->
        <Enum Name="VicsEntityType">
            <Entry Name="Unknown" Value="0"/>
            <Entry Name="VSCS_Ground" Value="1"/>
            <Entry Name="Dismount" Value="2"/>
            <Entry Name="Aircraft" Value="3"/>
            <Entry Name="UGS" Value="4"/>
        </Enum>
		
		<!-- The Type of VICS Message. -->
		<Enum Name="MessageType">
			<Entry Name="DismountMessage" Value="0" />
			<Entry Name="StateTransition" Value="1" />
			<Entry Name="IntruderAlert" Value="2" />
		</Enum>
		
		<!-- User-readable priority for dismount messages -->
		<Enum Name="MessagePriority">
			<Entry Name="Low" Value="0" />
			<Entry Name="Normal" Value="1" />
			<Entry Name="High" Value="2" />
		</Enum>

	</EnumList>
	
    <StructList>
	
		<!-- Base message for many VICS messages. Every entity must have uniquely
        identifiable message IDs such that given an originator ID and message ID,
        the specific message is uniquely identified. -->
		<Struct Name="VicsBase" >
			<!-- A unique message ID for all messages from originator entity -->
			<Field Name="MessageID" Type="int64" />
			<!-- A unique ID for the entity that generated the message -->
            <Field Name="OriginatorID" Type="int64" />
			<!-- ID of the immediate sender of this message (not necessarily the originator) -->
            <Field Name="SenderID" Type="int64" />
			<!-- A unique ID to indicate that specific messages are associated in the same group -->
            <Field Name="GroupID" Type="int64" />
			<!-- The type of entity generating the message -->
			<Field Name="OriginatorType" Type="VicsEntityType" />
			<!-- Time stamp of when the message was generated. -->
			<Field Name="TimeStamp" Type="int64" Units="milliseconds since 1 Jan 1970" />
			<!-- Priority of the message -->
			<Field Name="Priority" Type="MessagePriority" Default="Normal" />
		</Struct>
	
		<!-- Sent in response to any message on a TCP/IP connection -->
		<Struct Name="VicsAck">
			<!-- ID of message received -->
			<Field Name="ReceivedMessageID" Type="int64" />
			<!-- The unique ID for the received message originator -->
            <Field Name="ReceivedOriginatorID" Type="int64" />
			<!-- Number of bytes that were received -->
			<Field Name="ReceivedNumberOfBytes" Type="uint32" Units="None" />
		</Struct>

		<!-- Occurs when a vehicle relays a message from a dismount in the field.  -->
		<Struct Name="DismountMessage" Extends="VicsBase" >
			<!-- This is the actual payload data. -->
			<Field Name="Payload" Type="PayloadData" />
			<!-- Brief message description -->
			<Field Name="Description" Type="string" />
			<!-- The (optional) location at which payload was generated  -->
			<Field Name="Location" Type="CMASI/Location3D" Default="null" />
		</Struct>
        
        <!-- Configuration message for setting up the UGS wirelessly over multicast channel -->
        <Struct Name="UgsConfiguration" >
            <!-- ID of UGS to configure -->
            <Field Name="UgsID" Type="int64" />
            <!-- Default behavior of radar sensor -->
            <Field Name="DefaultRadarEnable" Type="bool" Default="true" />
            <!-- Direction (angle from true north, positive clockwise) that the radar sensor is aimed after placement -->
            <Field Name="HeadingAngle" Type="real32" Units="degrees" />
        </Struct>
      
        <!-- Request for UGS status over multicast channel -->
        <Struct Name="UgsStatusRequest" >
        </Struct>
      
        <!-- UGS current status sent over multicast channel in response to UgsStatusRequest -->
        <Struct Name="UgsStatusResponse" Extends="VicsBase" >
            <!-- Default behavior of radar sensor -->
            <Field Name="DefaultRadarEnable" Type="bool" Default="true" />
            <!-- Direction (angle from true north, positive clockwise) that the radar sensor is aimed after placement -->
            <Field Name="HeadingAngle" Type="real32" Units="degrees" />
            <!-- Reported lat/lon location. Null if not yet aquired GPS location -->
            <Field Name="ReportedLocation" Type="CMASI/Location3D" />
            <!-- Reported time -->
            <Field Name="CurrentTime" Type="int64" Units="milliseconds since 1 Jan 1970" />
        </Struct>
      
        <!-- Allow dismount to selectively enable or disable radar -->
		<Struct Name="RadarEnableMessage" >
			<!-- Ugs ID for which the radar should be enabled/disabled -->
			<Field Name="UgsID" Type="int64" />
			<!-- Indicates whether to enable or disable the radar after message reception and for time 'TimeOut' -->
			<Field Name="EnableRadar" Type="bool" Default="true" />
			<!-- Time out to revert to default UGS configuration -->
			<Field Name="TimeOut" Type="int64" Units="milliseconds" />
		</Struct>
		
		<!-- A possible array of payload data. -->
		<Struct Name="PayloadData">
			<!-- The byte array of payload data. Can be blank to show presence of a stored message. -->
			<Field Name="Data" Type="byte[]" Units="None" LargeArray="true" />
			<!-- Payload from the time of the event.  Could be nothing, text, images or video.  -->
			<Field Name="PayloadType" Type="PayloadType" Default="NoPayload"/>
			<!-- Expected payload size: not to be used for index in Data field. -->
			<Field Name="ExpectedPayloadSize" Type="uint32" />
		</Struct>

		<!-- Base class for intruder alerts, both red and green -->
		<Struct Name="IntruderAlertBase" Extends="VICS/VicsBase">
                </Struct>

		<!-- Contains a list of responses in answer to a MessageQuery (note: over tcp/ip channel) -->
		<Struct Name="QueryResponse" Extends="VicsBase" >
		    <!-- Latest alert reported. If not null and not already known,
                         it should be forwarded to all connected entities -->
		    <Field Name="LatestAlert" Type="IntruderAlertBase" Default="NULL" />
			<!-- The list of responses -->
			<Field Name="ResponseMessages" Type="GlobalMessageID[]" />
		</Struct>
	
		<!-- Contains a list of responses in answer to a MessageQuery (note: over tcp/ip channel) -->
		<Struct Name="CompleteQueryResponse" Extends="VicsBase" >
		    <!-- Latest alert reported. If not null and not already known,
                         it should be forwarded to all connected entities -->
		    <Field Name="LatestAlert" Type="IntruderAlertBase" Default="NULL" />
			<!-- Compressed SQLite sub-table of all messages that should be delivered -->
			<Field Name="ResponseTable" Type="byte[]" LargeArray="true" />
		</Struct>

		<!-- Identifier for a VICS message based on sender ID and message ID. Should be unique for the entire system -->
		<Struct Name="GlobalMessageID" >
			<!-- Sender ID of the message -->
			<Field Name="OriginatorID" Type="int64" />
			<!-- Specific ID of message unique to the sender -->
			<Field Name="MessageID" Type="int64" />
		</Struct>
		
		<!-- Contains a list of queries for requested types of messages. -->
		<Struct Name="MessageQuery" Extends="VicsBase">
			<!-- The list of queries. -->
			<Field Name="Queries" Type="MessageRequest[]" />
		</Struct>
		
		<!-- Represents a request to an entity for a set of messages of the same type in a given time span defined by the requestor. If the time span is (0,0) then all messages since the last time these entities talked is returned. If all messages since the begining are desired, send (0,now). The requestee responds with all messages of that type it has logged within that time span stripping off all payload data. If the MessageID is non-zero, then the time span is ignored and the full message matching that ID is returned (including all payload data upto 6MB). -->
		<Struct Name="MessageRequest">
			<!-- The type of message being requested in the VICS Series. -->
			<Field Name="RequestType" Type="MessageType" />
			<!-- The start time for the messages being requested. -->
			<Field Name="StartTime" Type="int64" Units="milliseconds since 1 Jan 1970" />
			<!-- The end time for the messages being requested. -->
			<Field Name="EndTime" Type="int64" Units="milliseconds since 1 Jan 1970" />
			<!-- Sender ID of message that should be delivered in full -->
			<Field Name="OriginatorID" Type="int64" />
			<!-- Specific ID of message that should be delivered in full -->
			<Field Name="MessageID" Type="int64" />
		</Struct>
	  
 </StructList>
</MDM>
