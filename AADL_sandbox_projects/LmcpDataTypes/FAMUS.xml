<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE MDM SYSTEM 'MDM.DTD'>

<!--
     FAMUS-specific message definitions. This defines new or modified messages
     used in the interface between UxAS autonomy services, FUSION pilot-vehicle
     interface and the aircraft (whether live or simulated in AFSIM).

     Messages from the CMASI (version 3) and the UxAS UXNATIVE message sets
     will be used in addition to these messages, as defined in the interface
     specification document.
-->

<MDM>
  <SeriesName>FAMUS</SeriesName>
  <Namespace>afrl/famus</Namespace>
  <Version>4</Version>

  <EnumList>

    <!-- afrl.famus.TurnDirection:
         Specifies preference for turn direction when changing heading
    -->
    <Enum Name="TurnDirection">
      <Entry Name="Shortest" Value="0" />
      <Entry Name="Left"     Value="1" />
      <Entry Name="Right"    Value="2" />
    </Enum>

    <!-- afrl.famus.Affiliation:
         Specifies perceived IFF status for an entity
    -->
    <Enum Name="Affiliation">
      <Entry Name="UNDEFINED" Value="0"/>
      <Entry Name="PENDING" Value="1"/>
      <Entry Name="UNKNOWN" Value="2"/>
      <Entry Name="ASSUMED_FRIEND" Value="3"/>
      <Entry Name="FRIEND" Value="4"/>
      <Entry Name="NEUTRAL" Value="5"/>
      <Entry Name="SUSPECT" Value="6"/>
      <Entry Name="HOSTILE" Value="7"/>
    </Enum>

    <!-- afrl.famus.EntityType:
         Specifies perceived vehicle category for an entity
    -->
    <Enum Name="EntityType">
      <Entry Name="AIR_INTERCEPTOR" Value="0"/>
      <Entry Name="BOMBER" Value="1"/>
      <Entry Name="AAM" Value="2"/>
      <Entry Name="SAM" Value="3"/>
      <Entry Name="SAM_LAUNCHER" Value="4"/>
      <Entry Name="AIR" Value="5"/>
      <Entry Name="SURFACE" Value="6"/>
      <Entry Name="SUBSURFACE" Value="7"/>
      <Entry Name="UNKNOWN" Value="8"/>
      <Entry Name="INVALID" Value="9"/>
    </Enum>

    <!-- afrl.famus.FormationType:
         Specifies the type of formation to fly
    -->
    <Enum Name="FormationType">
      <Entry Name="BODY_REF" Value="0"/>
      <Entry Name="GEO_REF" Value="1"/>
      <Entry Name="TRAIL" Value="2"/>
    </Enum>

  </EnumList>

  <StructList>

    <!-- afrl.famus.StartupComplete:
         Notify other components that this component (and all dependencies)
         have been started.  This message is expected to be sent by each 
         independently executed simulation component (i.e. UxAS, FUSION)
         when they are initialized and ready to execute.

         AFSIM (or aircraft platform adapter) will send this message once
         all components are initialized, *including* UxAS and FUSION.
         The aircraft startup complete will be identified with the label
         "master".

         The UpTime counter on each platform starts at zero from the
         origination time of this master StartupComplete message.  Most
         services should not begin processing or transmit messages until
         this master StartupComplete message is received.
    -->
    <Struct Name="StartupComplete">

        <!-- User-defined label for this component (should be unique) -->
        <Field Name="ComponentLabel" Type="string" />

        <!-- Unique ID of this platform -->
        <Field Name="EntityID" Type="int64" />

        <!-- Wall-clock (GPS) time when startup completed -->
        <Field Name="Time" Type="int64" Units="millisecond" />

    </Struct>


    <!-- afrl.famus.AirVehicleState:
         Provides basic states for an entity including position, velocity,
         acceleration, and orientation information.  PayloadStateList and Info
         fields will NOT be populated.

         This message is expected to be produced at 1 Hz by any entity that is
         running FAMUS autonomy services.  Non-cooperative entities
         (i.e. hostile or commercial traffic) would be represented by a
         Track message and not an AirVehicleState.
    -->
    <Struct Name="AirVehicleState" Extends="CMASI/AirVehicleState">

      <!-- Time since aircraft startup (NOT synchronized between platforms) -->
      <Field Name="UpTime" Type="int64" Units="millisecond" />

    </Struct>


    <!-- afrl.famus.AirVehicleConfiguration:
         Provides vehicle paramters and limits.

         This message is sent once during vehicle initialization, and in
         response to a ConfigurationRequest message.  This message will be sent
         from any aircraft runing FAMUS autonomy services, and NOT from any
         aircraft without FAMUS services.

         The local vehicle's network layer will ensure that an
         AirVehicleConfiguration message is generated for any vehicle joining
         the network, so that local services have knowledge of the capabilities
         of the new vehicle.
    -->
    <Struct Name="AirVehicleConfiguration" Extends="CMASI/AirVehicleConfiguration">

      <!-- Maximum fuel weight at 100% reported capacity (lbs) -->
      <Field Name="InitialEnergyQuantity" Type="real32" Units="pound" />

    </Struct>
    

    <!-- afrl.famus.ConfigurationRequest:
         Request retransmission of configuration messages
   -->
    <Struct Name="ConfigurationRequest">

      <!-- ID of vehicle for which configuration is requested (0: all vehicles) -->
      <Field Name="EntityID" Type="real64" />

    </Struct>


    <!-- afrl.famus.VectorSteeringTask:
         Request vehicle fly specified heading, speed and altitude
    -->
    <Struct Name="VectorSteeringTask" Extends="CMASI/Task">

      <!-- Requested vector steering command -->
      <Field Name="DesiredAction" Type="FlightDirectorAction" />

    </Struct>


    <!-- afrl.famus.WaypointSteeringTask:
        Request vehicle fly specified route,
        or change active waypoint on current route
    -->
    <Struct Name="WaypointSteeringTask" Extends="CMASI/Task">

      <!-- List of waypoints to be followed. If none, current route is used -->
      <Field Name="WaypointList" Type="CMASI/Waypoint[]" MaxArrayLength="1024" Units="None" />

      <!-- ID of the first waypoint to follow. -->
      <Field Name="FirstWaypoint" Type="int64"/>

    </Struct>


    <!-- afrl.famus.FormationNavigationTask:
        Request vehicle fly specified position relative to another vehicle
    -->
    <Struct Name="FormationNavigationTask" Extends="CMASI/Task">

      <!-- Vehicle ID to fly formation to -->
      <Field Name="LeadID" Type="uint32" Units="None" Optional="false" />

      <!-- Formation type -->
      <Field Name="FormationType" Type="FormationType" Optional="false" />

      <!-- Range offset (m) from lead (positive is away from lead, in direction of AngleOffset) -->
      <Field Name="RangeOffset" Type="real32" Units="meter" Default="500.0" />

      <!-- Angle offset (deg) based on formation type (ignored for TRAIL). Angle is relative to leader's heading (positive clockwise) for BODY_REF, and relative to true north (positive east) for GEO_REF. -->
      <Field Name="AngleOffset" Type="real32" Units="degree" Default="180.0" />

      <!-- Altitude offset (m) from lead (positive is above lead) -->
      <Field Name="AltitudeOffset" Type="real32" Units="meter" Default="-300.0" />

      <!-- Desired turn direction when joining up in formation -->
      <Field Name="Direction" Type="TurnDirection" Default="Shortest" />

      <!-- Maximum bank angle to use during maneuver (0: unlimited) -->
      <Field Name="MaxBankAngle" Type="real32" Units="degree" />

    </Struct>


    <!-- afrl.famus.TargetedNavigationTask:
         Request vehicle fly specified trajectory relative to another vehicle
    -->
    <Struct Name="TargetedNavigationTask" Extends="CMASI/Task">

      <!-- Track ID to fly relative to -->
      <Field Name="LeadID" Type="uint32" Units="None" Optional="false" />

      <!-- Altitude to fly (MSL) (m) -->
      <Field Name="AltitudeOffset" Type="real32" Units="meter" />

      <!-- True airspeed to fly (m/s) -->
      <Field Name="Speed" Type="real32" Units="meter/sec" />

      <!-- If true, Bearing is ignored and assigned vehicle will fly collision course to target -->
      <Field Name="CollisionCourse" Type="bool" Default="false" />

      <!-- Approach angle from nose of target; range is +/- 180 -->
      <Field Name="Bearing" Type="real32" Units="degree" />

      <!-- Desired turn direction when changing heading -->
      <Field Name="Direction" Type="TurnDirection" Default="Shortest" />

      <!-- Maximum bank angle to use during maneuver (0: unlimited) -->
      <Field Name="MaxBankAngle" Type="real32" Units="degree" />

    </Struct>



    <!-- afrl.famus.FlightDirectorAction:
         Request vehicle fly specified heading, speed and altitude
    -->
    <Struct Name="FlightDirectorAction" Extends="CMASI/FlightDirectorAction">

      <!-- Desired turn direction when changing heading -->
      <Field Name="TurnDirection" Type="TurnDirection" Default="Shortest" />

      <!-- Maximum bank angle to use during maneuver (0: unlimited) -->
      <Field Name="MaxBankAngle" Type="real32" Units="degree" />

    </Struct>


    <!--
        Represents a point in 3D space
    -->
    <Struct Name="Vector3D">
      <Field Name="x" Type="real32" Default="0.0"/>
      <Field Name="y" Type="real32" Default="0.0"/>
      <Field Name="z" Type="real32" Default="0.0"/>
    </Struct>


    <!--
           Defines sensed information for a sensor perception (track) either of an actual entity or potentially a false reading. When using the perceived fields
           the corresponding valid flag should be checked first, not all tracks will have all state information available. This will be determined
           by the capabilities of the sensor generating the track.
    -->
    <Struct Name="Track">

      <!-- Unique (within the scope of the platform) ID for this track -->
      <Field Name="TrackID" Type="int64" Default="0"/>

      <!-- Is perceived latitude valid for this track -->
      <Field Name="TargetLatitudeValid" Type="bool" Default="false"/>

      <!-- Perceived latitude of target (deg) -->
      <Field Name="TargetLatitude" Type="real64" Default="0"/>

      <!-- Is perceived longitude valid for this track -->
      <Field Name="TargetLongitudeValid" Type="bool" Default="false"/>

      <!-- Perceived longitude of target (deg) -->
      <Field Name="TargetLongitude" Type="real64" Default="0"/>

      <!-- Is perceived MSL altitude valid for this track -->
      <Field Name="TargetAltitudeValid" Type="bool" Default="false"/>

      <!-- Perceived MSL altitude of target (m) -->
      <Field Name="TargetAltitude" Type="real32" Units="meter" Default="0.0"/>

      <!-- Standard deviation of altitude error (m) -->
      <Field Name="TargetAltitudeError" Type="real32" Units="meter"/>

      <!-- Is perceived ECR position valid for this track -->
      <Field Name="TargetPositionValid" Type="bool" Default="false"/>

      <!-- Perceived ECR position of target (m) -->
      <Field Name="TargetPosition" Type="Vector3D" Units="meter/sec"/>

      <!-- Standard deviation of position error (m) -->
      <Field Name="TargetPositionError" Type="real32" Units="meter"/>

      <!-- Is perceived velocity valid for this track -->
      <Field Name="TargetVelocityValid" Type="bool" Default="false"/>

      <!-- Perceived ECR velocity of target (m/s) -->
      <Field Name="TargetVelocity" Type="Vector3D" Units="meter/sec"/>

      <!-- Standard deviation of velocity error (m/s) -->
      <Field Name="TargetVelocityError" Type="real32" Units="meter/sec"/>

      <!-- Is perceived true bearing valid for this track -->
      <Field Name="TargetTrueBearingValid" Type="bool" Default="false"/>

      <!-- Perceived true bearing from source to target (deg) -->
      <Field Name="TargetTrueBearing" Type="real32" Units="degree" Default="0.0"/>

      <!-- Standard deviation of bearing error (deg) -->
      <Field Name="TargetTrueBearingError" Type="real32" Units="degree"/>

      <!-- Is perceived elevation valid for this track -->
      <Field Name="TargetElevationValid" Type="bool" Default="false"/>

      <!-- Perceived elevation of target, relative to local horizontal (deg) -->
      <Field Name="TargetElevation" Type="real32" Units="degree" Default="0.0"/>

      <!-- Standard deviation of elevation error (deg) -->
      <Field Name="TargetElevationError" Type="real32" Units="degree"/>

      <!-- Is perceived range to target valid for this track -->
      <Field Name="TargetRangeValid" Type="bool" Default="false"/>

      <!-- Perceived range from source to target (m) -->
      <Field Name="TargetRange" Type="real32" Units="meter" Default="0.0"/>

      <!-- Standard deviation of range error (m) -->
      <Field Name="TargetRangeError" Type="real32" Units="meter"/>

      <!-- Is perceived range rate valid for this track -->
      <Field Name="TargetRangeRateValid" Type="bool" Default="false"/>

      <!-- Perceived range rate of target (m/s) -->
      <Field Name="TargetRangeRate" Type="real32" Units="meter/sec" Default="0.0"/>

      <!-- Standard deviation of range rate error (m/sec) -->
      <Field Name="TargetRangeRateError" Type="real32" Units="meter/sec"/>

      <!-- Is perceived target type valid for this track -->
      <Field Name="TargetTypeValid" Type="bool" Default="false"/>

      <!-- Perceived type of the target unit -->
      <Field Name="TargetType" Type="EntityType"/>

      <!-- Is perceived target affiliation for this track valid -->
      <Field Name="TargetAffiliationValid" Type="bool" Default="false"/>

      <!-- IFF-type target classification -->
      <Field Name="TargetAffiliation" Type="Affiliation"/>

      <!-- General track quality value, between 0 (worst) and 1 (best) -->
      <Field Name="Quality" Type="real32" Default="0.0"/>

      <!-- Unique ID of the platform that generated this track -->
      <Field Name="SourcePlatformID" Type="int64" Default="0"/>

      <!-- ID of the equipment that generated this track (unique within platform) -->
      <Field Name="SourceEquipID" Type="int32" Default="0"/>

      <!-- LLA of source unit when track was perceived -->
      <Field Name="SourceLocation" Type="CMASI/Location3D" Default="0.0"/>

      <!-- Time this track was created (milliseconds since Jan 1, 1970) -->
      <Field Name="TimeCreated" Type="int64" Units="millisecond" Default="0"/>

      <!-- Time the information for this track was perceived (ms since Jan 1, 1970) -->
      <Field Name="TimePerceived" Type="int64" Units="millisecond" Default="0"/>

      <!-- A container for key-value paris of metadata -->
      <Field Name="MetaData" Type="CMASI/KeyValuePair[]"/>

    </Struct>


    <!--
           Defines list of tracks.  This data type might be used at multiple
           levels of processing (i.e. raw tracks from a sensor or correlated tracks
           combining multiple data sources).  In almost every case, a derived
           class should be used instead, to clarify the type of track data
           that is being generated or consumed.
    -->
    <Struct Name="TrackList">

      <!-- Wall-clock (GPS) time when this message was sent -->
      <Field Name="Time" Type="int64" Units="millisecond" />

      <!-- Unique ID of the platform that generated this track list -->
      <Field Name="SourcePlatformID" Type="int64" Default="0"/>

      <!-- Human-readable description of the contents of this track list (for display and debugging purposes only)-->
      <Field Name="Description" Type="string" />

      <!-- List of currently active tracks (including coasted tracks) -->
      <Field Name="Tracks" Type="FAMUS/Track[]" MaxArrayLength="1024" Units="None" />

    </Struct>


    <!--
           Defines a list of two-dimensional tracks generated by
           one or more sensors (or processors) on a single platform.

           Tracks in this list have not yet been correlated, and contain
           information from a single source.
.
           This list contains information for all active tracks from a sensor,
           regardless of whether or not it was updated since the last message.
    -->
    <Struct Name="TwoDTrackList" Extends="TrackList">
    </Struct>


    <!--
           Defines a list of three-dimensional tracks generated by
           one or more sensors (or processors) on a single platform.

           Tracks in this list have not yet been correlated, and contain
           information from a single source.
.
           This list contains information for all active tracks from a sensor,
           regardless of whether or not it was updated since the last message.
    -->
    <Struct Name="ThreeDTrackList" Extends="TrackList">
    </Struct>


    <!--
           Defines a combined list of all tracks from any sources on a platform.

           Tracks in this list have been correlated, and contain the combined
           information on each target from all available sources.

           This list contains information for all active tracks from any sensor,
           regardless of whether or not it was updated since the last message.
    -->
    <Struct Name="MasterTrackList" Extends="TrackList">
    </Struct>


    <!--
           Defines a list of locally updated (or newly created) tracks, for
           coordination of master track lists among multiple platforms.

           Tracks in this list have been correlated, and contain the combined
           information on each target from all available sources.

           This list contains information for only the tracks that have been
           updated by a local sensor since the last transmisison of this message.
    -->
    <Struct Name="TrackUpdateList" Extends="TrackList">
    </Struct>

    <!--
           Reports the current command being executed by a vehicle,
           primarily for confirmation to the pilot that the request
           has been processed correctly.
    -->
    <Struct Name="TaskStatus">

      <!-- Wall-clock (GPS) time when this message was sent -->
      <Field Name="Time" Type="int64" Units="millisecond" />

      <!-- ID of the platform generating this message -->
      <Field Name="EntityID" Type="int64" Default="0"/>

      <!-- Task currently being executed by the vehicle -->
      <Field Name="ActiveTask" Type="CMASI/Task"/>

    </Struct>
    
    
    <!-- Extends the MustFlyTask to allow time of arrival specification
     -->
    <Struct Name="TimeOnTarget" Extends="CMASI/MustFlyTask">
        
        <!-- Time at which vehicle should arrive at the designated location.
         Time datum is defined by the application, but unless otherwise
         specified is milliseconds since 1 Jan 1970 -->
        <Field Name="TimeOfArrival" Type="int64" Units="milliseconds" />
        
    </Struct>
    
    
    <!-- Creates a racetrack pattern to carry out a Combat Air Patrol (CAP)
         oriented in a particular direction. Allows specification of speed
         window during pattern hold to allow speed variation in higher-level
         synchronization tasks. Optional sensor focus point uses desired
         wavelength to orient an appropriate sensor gimbal during pattern.
     -->
    <Struct Name="DirectedPatrol" Extends="CMASI/SearchTask">
        
        <!-- Geometric center of the pattern (cannot be null). Altitude value
             indicates the altitude at which this task should be carried out.
         -->
        <Field Name="CenterLocation" Type="CMASI/Location3D" />
        
        <!-- Clockwise angle from true north along which the down-range leg of
             the pattern is oriented.
         -->
        <Field Name="DownRangeDirection" Type="real32" Units="degrees" />

        <!-- Length of the pattern (dimension in down-range direction).
             The 'down-range' leg of the pattern starts at length/2 up-range
             from the center location.
         -->
        <Field Name="DownRangeLength" Type="real32" Units="meters" />
        
        <!-- Width of the pattern (orthogonal to down-range direction). If
             a value of 0.0 is indicated, the width will be re-sized to meet
             the minimum turn radius of the assigned vehicle.
         -->
        <Field Name="PatternWidth" Type="real32" Units="meters" />
        
        <!-- Direction of travel around the pattern.
         -->
        <Field Name="PatternDirection" Type="CMASI/LoiterDirection" Default="Clockwise" />
        
        <!-- Maximum speed allowed during execution. If set to 0.0, uses nominal speed
             of vehicle assigned.
         -->
        <Field Name="MaxSpeedAllowed" Type="real32" Units="m/s" />
        
        <!-- Minimum speed allowed during execution. If set to 0.0, uses nominal speed
             of vehicle assigned.
         -->
        <Field Name="MinSpeedAllowed" Type="real32" Units="m/s" />
        
        <!-- Optional sensor stare location during down-range leg traversal. Selects
             appropriate gimballed sensor based on desired wavelength band.
         -->
        <Field Name="SensorFocusPoint" Type="CMASI/Location3D" Optional="true" Default="null" />
        
    </Struct>
    
    
    <!-- A directed patrol augmented with a phase parameter to indicate relative
         phasing between multiple directed patrol patterns.
     -->
    <Struct Name="PhasedPatrol" Extends="FAMUS/DirectedPatrol">
        
        <!-- Phase difference from lead pattern. Defined as clockwise angle from
             down-range leg of lead pattern. For example, a value of 90 degrees
             indicates that this pattern will be half-way along its down-range leg
             when the lead is half-way through the turn toward its own up-range leg.
         -->
        <Field Name="PhaseAngle" Type="real32" Units="degrees" />
        
    </Struct>
    
    
    <!-- Super task to synchronize multiple Combat Air Patrol (CAP) patterns. Follower
         patterns use the location of the lead pattern vehicle to adjust speed to
         match prescribed phase angles. This task is only valid when vehicles and 
         sub-patrol patterns have compatible lengths, widths, and speed windows.
     -->
    <Struct Name="SynchronizedPatrol" Extends="CMASI/Task">
        
        <!-- Pattern followed by lead vehicle. Operates at mid-point of speed window.
             Cannot be null.
         -->
        <Field Name="LeadPattern" Type="FAMUS/DirectedPatrol" />
        
        <!-- Patterns for followers, each dynamically adjusting to acheive desired
             phase spacing.
         -->
        <Field Name="FollowerPatterns" Type="FAMUS/PhasedPatrol[]" />
        
        <!-- Flag to indicate that tight phase lock is to be sacrificed for additional
             down-range view time. When this flag is true, any follower that is on a 
             down-range leg operates at a slower speed (biased toward minimum allowable
             speed) and does not adjust speed while traveling down-range. Any vehicle
             approaching its down-range leg adjusts speed so that it starts down-range
             before a previous completes a down-range leg.
         -->
        <Field Name="BiasDownRange" Type="bool" Default="false" />
        
    </Struct>

  </StructList>
</MDM>
